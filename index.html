<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Saree Bazaar ‚Äî AI Smart Store</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<style>
body {
  margin:0;
  font-family:'Poppins',sans-serif;
  background:#fafafa;
  color:#333;
}
header {
  background:linear-gradient(90deg,#d81b60,#ec407a);
  color:white;
  padding:1rem;
  text-align:center;
  font-size:1.6rem;
  font-weight:600;
  letter-spacing:1px;
}
.container {
  max-width:1200px;
  margin:auto;
  padding:1rem;
}
button {
  background:#d81b60;
  color:white;
  border:none;
  padding:0.6rem 1.2rem;
  border-radius:8px;
  cursor:pointer;
  transition:0.2s;
}
button:hover {opacity:0.9;}
input,textarea,select {
  width:100%;
  padding:0.6rem;
  margin:0.3rem 0;
  border:1px solid #ccc;
  border-radius:8px;
}
.card {
  background:white;
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
  overflow:hidden;
  text-align:center;
  transition:transform 0.2s;
}
.card:hover {transform:translateY(-4px);}
.card img {
  width:100%;
  height:250px;
  object-fit:cover;
}
.card h3 {margin:0.5rem 0;}
.card p {margin:0.3rem 0;}
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:1rem;
}
#adminPanel,#loginPanel {display:none;}
#shopList img {border-bottom:1px solid #eee;}
@media(max-width:600px){
  .card img {height:200px;}
}
</style>
</head>
<body>

<header>üõçÔ∏è Saree Bazaar</header>
<div class="container">

  <div id="loginPanel" style="text-align:center;">
    <h3>Admin Login</h3>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPass" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>

  <div id="adminPanel">
    <h3>Add New Saree Product</h3>
    <input type="text" id="pName" placeholder="Product Name (e.g., Aqua Blue Maheshwari Saree)">
    <input type="text" id="pBrand" placeholder="Brand (e.g., Jaypore)">
    <input type="number" id="pPrice" placeholder="Price ‚Çπ">
    <select id="pSize"><option>Free Size</option><option>Small</option><option>Medium</option><option>Large</option></select>
    <textarea id="pDesc" placeholder="Description"></textarea>
    <input type="file" id="pImg" accept="image/*">
    <button onclick="addProduct()">Add Product</button>
    <button onclick="logout()">Logout</button>
    <hr>
    <div id="productList" class="grid"></div>
  </div>

  <div id="shopPanel">
    <h3 style="text-align:center;">üå∏ Available Sarees üå∏</h3>
    <div id="shopList" class="grid"></div>
    <div style="text-align:center;margin-top:1rem;">
      <button onclick="showLogin()">Admin Login</button>
    </div>
  </div>

</div>

<script>
// ---------------- Firebase Config ----------------
const firebaseConfig = {
  apiKey: "AIzaSyARRGuy8RIUifqadGxzF3BF3O4MAVFvfyo",
  authDomain: "gasbooking-95fd5.firebaseapp.com",
  databaseURL: "https://gasbooking-95fd5-default-rtdb.firebaseio.com",
  projectId: "gasbooking-95fd5",
  storageBucket: "gasbooking-95fd5.appspot.com",
  messagingSenderId: "1025660657409",
  appId: "1:1025660657409:web:5bf712af78a9632b7ac500",
  measurementId: "G-BDNNBSF4BJ"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ---------------- Auth ----------------
function showLogin(){
  document.getElementById('shopPanel').style.display='none';
  document.getElementById('loginPanel').style.display='block';
}
function login(){
  const email=document.getElementById('loginEmail').value;
  const pass=document.getElementById('loginPass').value;
  if(email==="saree@gmail.com" && pass==="123456"){
    loadAdmin();
  }else{
    alert("Invalid login or not registered");
  }
}
function logout(){
  document.getElementById('adminPanel').style.display='none';
  document.getElementById('shopPanel').style.display='block';
}

// ---------------- Image Compression (smaller ratio) ----------------
function compressImage(file,maxWidth=300,maxHeight=300,quality=0.5){
  return new Promise(resolve=>{
    const reader=new FileReader();
    reader.onload=e=>{
      const img=new Image();
      img.onload=()=>{
        let canvas=document.createElement('canvas');
        let width=img.width,height=img.height;
        if(width>height && width>maxWidth){
          height*=maxWidth/width;width=maxWidth;
        }else if(height>maxHeight){
          width*=maxHeight/height;height=maxHeight;
        }
        canvas.width=width;canvas.height=height;
        const ctx=canvas.getContext('2d');
        ctx.drawImage(img,0,0,width,height);
        resolve(canvas.toDataURL('image/jpeg',quality));
      };
      img.src=e.target.result;
    };
    reader.readAsDataURL(file);
  });
}

// ---------------- Add Product ----------------
async function addProduct(){
  const name=document.getElementById('pName').value.trim();
  const brand=document.getElementById('pBrand').value.trim();
  const price=document.getElementById('pPrice').value.trim();
  const desc=document.getElementById('pDesc').value.trim();
  const size=document.getElementById('pSize').value;
  const file=document.getElementById('pImg').files[0];

  if(!name||!brand||!price||!desc||!file){
    alert("‚ö†Ô∏è Please fill all fields and choose an image.");
    return;
  }

  try {
    const imgData=await compressImage(file,300,300,0.4); // smaller size + compression
    const id=db.ref('products').push().key;
    await db.ref('products/'+id).set({name,brand,price,desc,size,img:imgData});
    alert("‚úÖ Product added successfully!");
    document.getElementById('pName').value='';
    document.getElementById('pBrand').value='';
    document.getElementById('pPrice').value='';
    document.getElementById('pDesc').value='';
    document.getElementById('pImg').value='';
  } catch (err) {
    console.error(err);
    alert("‚ùå Image processing failed. Try again with a smaller image.");
  }
}

// ---------------- Load Admin ----------------
function loadAdmin(){
  document.getElementById('loginPanel').style.display='none';
  document.getElementById('shopPanel').style.display='none';
  document.getElementById('adminPanel').style.display='block';
  db.ref('products').on('value',snap=>{
    const data=snap.val()||{};
    const list=document.getElementById('productList');
    list.innerHTML='';
    Object.entries(data).forEach(([id,p])=>{
      list.innerHTML+=`
        <div class="card">
          <img src="${p.img}" alt="${p.name}">
          <h3>${p.name}</h3>
          <p><b>${p.brand}</b></p>
          <p>‚Çπ${p.price}</p>
          <p>${p.size}</p>
          <button onclick="delProduct('${id}')">Delete</button>
        </div>`;
    });
  });
}

// ---------------- Load Shop ----------------
function loadShop(){
  db.ref('products').on('value',snap=>{
    const data=snap.val()||{};
    const list=document.getElementById('shopList');
    list.innerHTML='';
    Object.values(data).forEach(p=>{
      list.innerHTML+=`
        <div class="card">
          <img src="${p.img}" alt="${p.name}">
          <h3>${p.name}</h3>
          <p><b>${p.brand}</b></p>
          <p>${p.desc}</p>
          <p><b>‚Çπ${p.price}</b></p>
          <p>Size: ${p.size}</p>
          <button>Add to Cart</button>
        </div>`;
    });
  });
}
loadShop();

// ---------------- Delete Product ----------------
function delProduct(id){
  if(confirm("Delete this product?")){
    db.ref('products/'+id).remove();
  }
}
</script>

</body>
</html>
